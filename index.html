<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Slope</title>
    <link rel="icon">
    <meta name="viewport" content="width=device-width">
    <link href="./y8-studio/unity/config/TemplateData56/style.css" rel="stylesheet">
    <link href="./y8-studio/unity/config/shared/style.css" rel="stylesheet">
    <link href="./y8-studio/unity/config/shared/gamebreak/gamebreak.css" rel="stylesheet">
    <script src="./y8-studio/unity/config/shared/lib.js" type="text/javascript"></script>
    <script src="./y8-studio/unity/config/shared/browser_detector.js" type="text/javascript"></script>
    <script src="./y8-studio/unity/config/shared/sound_enabler.js" type="text/javascript"></script>
    <script src="./y8-studio/unity/config/shared/metrika.js" type="text/javascript"></script>
    <script src="./y8-studio/unity/config/shared/gamebreak/gamebreak.js" type="text/javascript"></script>
    <script src="./y8-studio/unity/config/TemplateData56/game.js" type="text/javascript"></script>
    <script src="./y8-studio/unity/config/TemplateData56/UnityProgress.js"></script>
    <script src="./y8-studio/unity/joll/slope/Build/UnityLoader.js"></script>
    <script>
      var gameInstance = UnityLoader.instantiate("gameContainer", "./y8-studio/unity/joll/slope/Build/slope_27Sept.json", {onProgress: UnityProgress,Module:{onRuntimeInitialized: function() {UnityProgress(gameInstance, "complete")}}});
    </script>
    <link rel="canonical" href="https://www.y8.com/games/slope">
  </head>
  <script>
    var version = "1.0.1";
    var masked = false;
    var title = "The Purposes of Education in Youth";
    init();

    function init() {
      console.log("Loading...");
      maskTabs(true);

      document.addEventListener('keydown', function(event) {
        const key = event.key.toLowerCase();
        console.log("Detected key: " + key);

        switch (key) {
          case "q":
            //hideCursor();
            break;
          
          case "k":
            openMaskWebsite();
            break;
          
          case "m":
            maskTabs();
            break;

          default:
            break;
        }
      });
    }

    function maskTabs(init = false) {
      const element = document.querySelector("link[rel~='icon']");
      console.log("mask tab: " + (init ? "initializing" : (masked ? "unmasking" : "masking")));

      if (init) {
        element.href = "icon.png?" + new Date().getTime();
        return;
      }

      if (masked) {
        masked = false;
        document.title = "Slope";
        element.href = "icon.png?" + new Date().getTime();
        document.getElementById("mask-tab-button").innerText = "Mask Tab";
      } else {
        masked = true;
        document.title = title;
        element.href = "mask.png?" + new Date().getTime();
        document.getElementById("mask-tab-button").innerText = "Unmask Tab";
      }
    }

    function openMaskWebsite() {
      const url = localStorage.getItem('fakeWebsite') ?? "https://classroom.google.com";
      console.log("Opening URL " + url);
      window.open(url, "_blank");
    }

    function hideCursor() {
      document.body.style.cursor = "none";
      document.addEventListener('mousemove', showCursor);
    }

    function showCursor() {
      document.body.style.cursor = "auto";
      document.removeEventListener('mousemove', showCursor);
    }

    function keypress(key, code) {
      // Example:
        // key: "a"
        // code: "KeyA"

      const event = new KeyboardEvent('keydown', {
        key: key,
        code: code,
        keyCode: 65,
        which: 65,
        bubbles: true,
      });

      console.log("sending key " + key + " (" + code + ")");
      document.dispatchEvent(event);
    }
  </script>
  <body>
    <div id="content">
      <div style="height: 700px;"></div>
      <p><span id="version-text">Loading...</span><br>Original game by Y8</p>
      <p>Move: AD, QD, or &larr;&rarr;<br>Mask tab: M<br>Open fake website: K</p>
      <button id="mask-tab-button" onclick="maskTabs()">Mask Tab</button>
      <button onclick="openMaskWebsite()">Fake Website</button>
    </div>
    <div id="container" class="container webgl-content">
      <div id="gameContainer" style="width: 99vw; height: 600px"></div>
      <div class="footer">
        <div class="unity disable"></div>
        <div class="webgl enable"></div>
        <h1 class="game-name">Slope</h1>
        <div class="fullscreen" onclick="gameInstance.SetFullscreen(1)">Maximize</div>
      </div>
    </div>
  </body>
  <script>
    document.getElementById("version-text").innerText = "Slope Clone V. " + version;
  </script>
</html>
